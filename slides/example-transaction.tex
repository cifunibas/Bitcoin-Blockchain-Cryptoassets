% Choose one to switch between slides and handout
\documentclass[]{beamer}
%\documentclass[handout]{beamer}

% Video Meta Data
\title{Bitcoin, Blockchain and Cryptoassets}
\subtitle{Transaction Examples}
\author{Prof. Dr. Fabian Sch√§r}
\institute{University of Basel}

% Config File
\input{../config/config.tex}
\usepackage{fancybox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\thispagestyle{empty}
\begin{frame}[noframenumbering]
	\titlepage
\end{frame}

%%%
\begin{frame}{Prerequisites}
	\begin{itemize}
		\item<1->{Hexadecimal values (Base 16)}
		\item<2->{Endianness:}
			\begin{itemize}
				\item<2->{1 in big-endian: 00000001}
				\item<3->{1 in little-endian: 01000000}
			\end{itemize}
		\item<4->{Hash functions}
		\item<5->{ECDSA}\\
	\end{itemize}
\end{frame}
%%%	


%%%
\begin{frame}{Pay-to-Public-Key}
	\href{https://blockstream.info/tx/f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16}{\link The first Bitcoin transaction:}
	\begin{figure}
		\input{../assets/figures/first_transaction.tex}
	\end{figure}
\end{frame}
%%%

%%%
\begin{frame}{Transaction Inputs}
	\begin{figure}
		\input{../assets/figures/transaction-structure-example.tex}
	\end{figure}
	\uncover<2->{
		\scriptsize
			\begin{tabular}{ll}
				\texttt{scriptPubKey} from the previous transaction: & \\
				\texttt{OP\_PUSHBYTES\_65:} & \texttt{41}\\
				Uncompressed public key: & \texttt{04}\\
				Public key: & \texttt{11db93e1dcdb8a016b49840f8c53bc1e}\\
				 & \texttt{b68a382e97b1482ecad7b148a6909a5c}\\
				 & \texttt{b2e0eaddfb84ccf9744464f82e160bfa}\\
				 & \texttt{9b8b64f9d4c03f999b8643f656b412a3}\\
				\texttt{OP\_CHECKSIG:} & \texttt{ac}
			\end{tabular}
	}
	\vspace{0.5em}\\
	\small
	\uncover<3->{$\rightarrow$ If you know the private key to \texttt{11db...a3} you can spend the UTXO \phantom{$\rightarrow$} of 50 BTC.}
\end{frame}
%%%

%%%
\begin{frame}{Transaction Outputs}
	\begin{figure}
		\input{../assets/figures/transaction-structure-example2.tex}
	\end{figure}
\end{frame}

\begin{frame}{Transaction Outputs}
	\scriptsize
	\textbf{First output:}\\
	\begin{tabular}{ll}
	10 BTC & = 1,000,000,000 Satoshis\\
	\uncover<2->{& = \texttt{00ca9a3b00000000} as little-endian integer}\\
	\uncover<3->{\texttt{scriptPubKey:} & \\
		\texttt{OP\_PUSHBYTES\_65:} & \texttt{41}\\
		Uncompressed public key: & \texttt{04}\\
		Public key: & \texttt{ae1a62fe09c5f51b13905f07f06b99a2}\\
		 & \texttt{f7159b2225f374cd378d71302fa28414}\\
		 & \texttt{e7aab37397f554a7df5f142c21c1b730}\\
		 & \texttt{3b8a0626f1baded5c72a704f7e6cd84c}\\
		\texttt{OP\_CHECKSIG:} & \texttt{ac}
	}
	\end{tabular}
	\vspace{1em}\\
	\textbf{Second output (''change"):}\\
	\begin{tabular}{ll}
	40 BTC & = 4,000,000,000 Satoshis\\
	\uncover<2->{& = \texttt{00286bee00000000} as little-endian integer}\\
	\uncover<3->{\texttt{scriptPubKey:} & \\
		\texttt{OP\_PUSHBYTES\_65:} & \texttt{41}\\
		Uncompressed public key: & \texttt{04}\\
		Public key: & \texttt{11db93e1dcdb8a016b49840f8c53bc1e}\\
		 & \texttt{b68a382e97b1482ecad7b148a6909a5c}\\
		 & \texttt{b2e0eaddfb84ccf9744464f82e160bfa}\\
		 & \texttt{9b8b64f9d4c03f999b8643f656b412a3}\\
		\texttt{OP\_CHECKSIG:} & \texttt{ac}
	}
	\end{tabular}

\end{frame}

\begin{frame}{Transaction Inputs and Outputs}
	\begin{figure}
		\input{../assets/figures/transaction-structure-example3.tex}	
	\end{figure}

\end{frame}


%%%
%\begin{frame}{Transaction Hash}
%\begin{itemize}
%\item Transaction Hash: \\
%{\scriptsize \texttt{f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16}}
%\item SHA256(SHA256(Raw TRX Data)) $\rightarrow$ TRX Hash
%\end{itemize}
%\end{frame}
%%%	


%%%
\begin{frame}{Raw Transaction Data (Additional Information)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{01c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704
00000000}\textcolor{focus}{4847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548
ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d
1d0901}ffffffff\textcolor{highlight}{0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f715
9b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1bade
d5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1e
b68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4
c03f999b8643f656b412a3ac}00000000}
\vspace{1em}
\end{scriptsize}
\scriptsize \\
\uncover<2->{\textbf{Black sections:}}\\
\begin{itemize}
	\item<2-> Version as little-endian integer: \texttt{01000000}
	\item<2-> Sequence number (deprecated): \texttt{ffffffff}
	\item<2-> Timelock: \texttt{00000000}
\end{itemize}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Input)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{01c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704
00000000}\textcolor{focus}{4847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548
ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d
1d0901}ffffffff\textcolor{highlight}{0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f715
9b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1bade
d5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1e
b68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4
c03f999b8643f656b412a3ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\textbf{First mint section:}\\
\begin{itemize}
	\item 1 input: \texttt{01}
	\item Previous transaction in reverse byte order: \texttt{c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704}
	\item Index of the output within the previous transaction as little-endian integer: \texttt{00000000}
\end{itemize}
\end{frame}
%%%


%%%
\begin{frame}{Raw Transaction Data (Outputs)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{01c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704
00000000}\textcolor{focus}{4847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548
ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d
1d0901}ffffffff\textcolor{highlight}{0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f715
9b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1bade
d5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1e
b68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4
c03f999b8643f656b412a3ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\textbf{Second mint section:}\\
\begin{columns}[T]
\column{0.5\textwidth}
\begin{itemize}
	\item 2 outputs: \texttt{02}
	\item 10 BTC: \texttt{00ca9a3b00000000}
	\item 67 byte long \texttt{scriptPubKey}: \texttt{43}
	\item 65 byte long uncompressed public key: \texttt{4104}
	\item Public key
	\item \texttt{OP\_CHECKSIG}: \texttt{ac}
\end{itemize}
\column{0.5\textwidth}
\begin{itemize}
	\item 40 BTC ''change": \texttt{00286bee00000000}
	\item 67 byte long \texttt{scriptPubKey}: \texttt{43}
	\item 65 byte long uncompressed public key: \texttt{4104}
	\item Public key
	\item \texttt{OP\_CHECKSIG}: \texttt{ac}
\end{itemize}
\end{columns}

\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Signature)}
	\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{01c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704
00000000}\textcolor{focus}{4847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548
ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d
1d0901}ffffffff\textcolor{highlight}{0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f715
9b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1bade
d5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1e
b68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4
c03f999b8643f656b412a3ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\textbf{Red section:}\\
\begin{columns}[T]
\column{0.5\textwidth}
\begin{itemize}
	\item 72 byte long \texttt{scriptSig}: \texttt{48}
	\item 71 byte long signature: \texttt{47}
	\item DER sequence follows: \texttt{30}
	\item 68 bytes long: \texttt{44}
	\item An integer follows: \texttt{02}
	\item The integer is 32 bytes long: \texttt{20}
	\item $r$ from the ECDSA signature: 	\texttt{4e45e16932b8af514961a1d3a1a25fdf\\3f4f7732e9d624c6c61548ab5fb8cd41}
\end{itemize}
\column{0.5\textwidth}
\begin{itemize}
	\item An integer follows: \texttt{02}
	\item The integer is 32 bytes long: \texttt{20}
	\item $s$ from the ECDSA signature: \texttt{181522ec8eca07de4860a4acdd12909d\\831cc56cbbac4622082221a8768d1d09}
	\item \texttt{SIGHASH\_ALL}: \texttt{01}
\end{itemize}
\end{columns}
\end{frame}
%%%

%%%
\begin{frame}{Bitcoin Script}
\begin{columns}
\column{0.5\textwidth}
\begin{figure}
	\input{../assets/figures/example_p2pk}
\end{figure}

\column{0.5\textwidth}
\begin{enumerate}
\item<1-> \texttt{<sig>}
\item<2-> \texttt{<PubKey>} from previous trx
\item<3-> \texttt{OP\_Checksig} from previous trx
\item<4-> Check if they match
\item<5-> If yes $\rightarrow$ \texttt{1} \\ If not $\rightarrow$ \texttt{0} 
\end{enumerate}

\end{columns}
\end{frame}
%%%

%%%%
%\begin{frame}{Signature}
%	We do not know Satoshi's private key.\\
%	What is signed exactly? Transaction message?	\\
%	How is it encoded?
%\end{frame}
%%%%
%
%%%%
%\begin{frame}{Verification}
%	Script:\\
%	Define Bitcoin's elliptic curve and the generator point.\\
%	Define Satoshi's public key.\\
%	Get $r$ and $s$ from the \texttt{scriptSig}.\\
%	We know the transaction message from the last slide.\\
%	Find $u_1$ and $u_2$.\\
%	Find $P$.\\
%	Authentic if $P_x\ (mod\ p) == r$ is true.\\
%\end{frame}
%%%%

%%%
\begin{frame}{Pay-to-Public-Key-Hash}
	\href{https://blockstream.info/tx/a1075db55d416d3ca199f55b6084e2115b9345e16c5cf302fc80e9d5fbf5d48d}{\link The pizza transaction:}\\
	\begin{figure}
	\includegraphics[scale=0.3]{../assets/images/pizza_blogpost}	
	\caption*{\href{https://bitcointalk.org/index.php?topic=137.0}{\link bitcointalk.org}}
	\end{figure}
\end{frame}
%%%

%%%
\begin{frame}{From Public Key to Bitcoin Address}
\begin{figure}
	\input{../assets/figures/pubkey_to_address}
\end{figure}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data}
	\begin{itemize}
		\item The transaction uses 131 inputs.
		\item The complete raw transaction data is very long.
		\item Let's focus on the unlocking condition and differences to P2PK.
	\end{itemize}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Additional Information)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{830d2e8f94c33a10f3834554cc1f1469e069f0fcf31a47309d42a9d00f4ba5
7d8600000000}\textcolor{focus}{8c493046022100bc57dc26f46fecc1da03272cb2298d8a08b22d865541
f5b3a3e862cc87da4b47022100ce1fc72771d164d608b15065832542a0e9040cfdf288
62c5175c81fcb0e0b65501410434417dd8d89deaf0f6481c2c160d6de0921624ef7b95
6f38eef9ed4a64e36877be84b77cdee5a8d92b7d93694f89c3011bf1cbdf4fd7d8ca13
b58a7bb4ab0804}ffffffff\textcolor{black!50}{...}\textcolor{highlight}{010010a5d4e80000001976a91446af3fb481837fadbb4
21727f9959c2d32a3682988ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\uncover<2->{\textbf{Black sections:}}\\
\begin{itemize}
	\item<2-> Version as little-endian integer: \texttt{01000000}
	\item<2-> Sequence number (deprecated): \texttt{ffffffff}
	\item<2-> Timelock: \texttt{00000000}
\end{itemize}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Inputs)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{830d2e8f94c33a10f3834554cc1f1469e069f0fcf31a47309d42a9d00f4ba5
7d8600000000}\textcolor{focus}{8c493046022100bc57dc26f46fecc1da03272cb2298d8a08b22d865541
f5b3a3e862cc87da4b47022100ce1fc72771d164d608b15065832542a0e9040cfdf288
62c5175c81fcb0e0b65501410434417dd8d89deaf0f6481c2c160d6de0921624ef7b95
6f38eef9ed4a64e36877be84b77cdee5a8d92b7d93694f89c3011bf1cbdf4fd7d8ca13
b58a7bb4ab0804}ffffffff\textcolor{black!50}{...}\textcolor{highlight}{010010a5d4e80000001976a91446af3fb481837fadbb4
21727f9959c2d32a3682988ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\textbf{First mint section:}\\
\begin{itemize}
	\item 131 inputs: \texttt{83}
	\item Previous transaction in reverse byte order: \texttt{0d2e8f94c33a10f3834554cc1f1469e069f0fcf31a47309d42a9d00f4ba57d86}
	\item Index of the output within the previous transaction as little-endian integer: \texttt{00000000}
	\item \dots
\end{itemize}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Signature)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{830d2e8f94c33a10f3834554cc1f1469e069f0fcf31a47309d42a9d00f4ba5
7d8600000000}\textcolor{focus}{8c493046022100bc57dc26f46fecc1da03272cb2298d8a08b22d865541
f5b3a3e862cc87da4b47022100ce1fc72771d164d608b15065832542a0e9040cfdf288
62c5175c81fcb0e0b65501410434417dd8d89deaf0f6481c2c160d6de0921624ef7b95
6f38eef9ed4a64e36877be84b77cdee5a8d92b7d93694f89c3011bf1cbdf4fd7d8ca13
b58a7bb4ab0804}ffffffff\textcolor{black!50}{...}\textcolor{highlight}{010010a5d4e80000001976a91446af3fb481837fadbb4
21727f9959c2d32a3682988ac}00000000}
\end{scriptsize}
\vspace{1em}
\scriptsize \\
\textbf{Red section:}\\
\begin{columns}[T]
\column{0.5\textwidth}
\begin{itemize}
	\item 140 byte long \texttt{scriptSig}: \texttt{8c}
	\item 73 byte long signature: \texttt{49}
	\item DER sequence follows: \texttt{30}
	\item 70 bytes long: \texttt{46}
	\item An integer follows: \texttt{02}
	\item The integer is 33 bytes long: \texttt{21}
	\item $r$ from the ECDSA signature: 	\texttt{00bc57dc26f46fecc1da03272cb2298d8\\
	a08b22d865541f5b3a3e862cc87da4b47}
	\item An integer follows: \texttt{02}
	\item The integer is 33 bytes long: \texttt{21}
\end{itemize}
\column{0.5\textwidth}
\begin{itemize}
	\item $s$ from the ECDSA signature: \texttt{00ce1fc72771d164d608b15065832542a\\
	0e9040cfdf28862c5175c81fcb0e0b655}
	\item \texttt{SIGHASH\_ALL}: \texttt{01}
	\item 65 byte long public key: \texttt{41}
	\item Uncompressed public key: \texttt{04}
	\item Public key: \texttt{34417dd8d89deaf0f6481c2c160d6de0\\
	921624ef7b956f38eef9ed4a64e36877\\
	be84b77cdee5a8d92b7d93694f89c301\\
	1bf1cbdf4fd7d8ca13b58a7bb4ab0804}
\end{itemize}
\end{columns}
\end{frame}
%%%

%%%
\begin{frame}{Raw Transaction Data (Output)}
\begin{scriptsize}
\texttt{01000000\textcolor{highlight}{830d2e8f94c33a10f3834554cc1f1469e069f0fcf31a47309d42a9d00f4ba5
7d8600000000}\textcolor{focus}{8c493046022100bc57dc26f46fecc1da03272cb2298d8a08b22d865541
f5b3a3e862cc87da4b47022100ce1fc72771d164d608b15065832542a0e9040cfdf288
62c5175c81fcb0e0b65501410434417dd8d89deaf0f6481c2c160d6de0921624ef7b95
6f38eef9ed4a64e36877be84b77cdee5a8d92b7d93694f89c3011bf1cbdf4fd7d8ca13
b58a7bb4ab0804}ffffffff\textcolor{black!50}{...}\textcolor{highlight}{010010a5d4e80000001976a91446af3fb481837fadbb4
21727f9959c2d32a3682988ac}00000000}
\end{scriptsize}
\vspace{1em}
	\scriptsize \\
	\textbf{Second mint section:}\\
	\begin{columns}
	\column{0.5\textwidth}
	\begin{itemize}
		\item 1 output: \texttt{01}
		\item 10,000 BTC: \texttt{0010a5d4e8000000}
		\item 26 byte long \texttt{scriptPubKey}: \texttt{19}
		\item \texttt{OP\_DUP}: \texttt{76}
		\item \texttt{OP\_HASH160}: \texttt{a9}
	\end{itemize}
	\column{0.5\textwidth}
	\begin{itemize}
		\item 20 byte long Public Key Hash: \texttt{14}
		\item \texttt{Hash160}:\\
		\texttt{46af3fb481837fadbb42\\1727f9959c2d32a36829}
		\item \texttt{OP\_EQUALVERIFY}: \texttt{88}
		\item \texttt{OP\_CHECKSIG}: \texttt{ac}
	\end{itemize}
	\end{columns}
	\vspace{1em}
	\uncover<2->{$\rightarrow$ Duplicate the public key \texttt{XYZ} and take the \texttt{Hash160} of it to get \texttt{46af...6829}}\\
	\uncover<3->{$\rightarrow$ If you know the private key to this public key, you can spend the 10,000 BTC.}
\end{frame}
%%%


%%%
\begin{frame}{Bitcoin Script}
\begin{columns}
\column{0.5\textwidth}
\begin{figure}
	\input{../assets/figures/example_p2pkh}
\end{figure}
\column{0.5\textwidth}
\begin{enumerate}
\item<1-> \texttt{<sig>} and \texttt{<pubKey>}
\item<2-> \texttt{OP\_Dup}
\item<6-> \texttt{OP\_Hash160}
\item<10-> \texttt{pubKeyHash}
\item<11-> \texttt{OP\_Equalverify}
\item<14-> \texttt{OP\_Checksig}
\end{enumerate}
\end{columns}
\end{frame}
%%%

\end{document}