% Choose one to switch between slides and handout
\documentclass[]{beamer}
%\documentclass[handout]{beamer}

% Video Meta Data
\title{Bitcoin, Blockchain and Cryptoassets}
\subtitle{Block Assembly \& Chain Structure}
\author{Prof. Dr. Fabian Sch√§r}
\institute{University of Basel}

% Config File
\input{../config/config.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\thispagestyle{empty}
\begin{frame}[noframenumbering]
	\titlepage
\end{frame}

%%%
\begin{frame}{Transaction Distribution}
\begin{figure}
	\centering
	\begin{tikzpicture}[scale=0.9, every node/.style={scale=0.9}]
		\input{../assets/figures/transaction_distribution}
	\end{tikzpicture}
\end{figure}
\end{frame}
%%%	


%%%
\begin{frame}{From Transactions to Blocks}
	\begin{enumerate}
		\item<1-> Node sends his transaction to the connected peers.
		\item<1-> Each node verifies the received transaction
			\begin{itemize}
				\item<1-> Input, Output, Signatures
			\end{itemize}			 
		\item<1-> If the transaction is valid, it is \dots
			\begin{itemize}
				\item<1-> \dots forwarded to respective peers.
				\item<1-> \dots stored in own transaction mempool.
			\end{itemize}
	\end{enumerate}	
	\vspace{1em}
	\uncover<1->{Miners will take the transactions from their mempool and form a block, but how is this done?}
\end{frame}
%%%

%%%
\begin{frame}{Merkle Root}
	\begin{columns}
	\column{0.7\textwidth}
		\begin{figure}
			\input{../assets/figures/merkle_tree}
		\end{figure}
		\begin{itemize}
			\item Represents all transactions of the block in the form of a compact 256-bit entry.
			\item Guarantees that the transaction data of a block cannot be modified unnoticed.
		\end{itemize}
	\column{0.3\textwidth}
		\begin{figure}
			\input{../assets/figures/block_content_1}
		\end{figure}
	\end{columns}
\end{frame}
%%%


%%%
\begin{frame}{Version, Reference \& Timestamp}
	\begin{columns}
	\column{0.7\textwidth}
		\begin{itemize}
			\item \textbf{Version:} Followed ruleset of block creation, implicates validation rules.
			\item \textbf{Reference:} Hash value of predecessor block header $\rightarrow$ Basis for chain structure.
			\item \textbf{Timestamp:} At least median timestamp of the previous eleven blocks, not more than two hours in the future at the time of inclusion in the blockchain. 
		\end{itemize}
	\column{0.3\textwidth}
		\begin{figure}
			\input{../assets/figures/block_content_2}
		\end{figure}
	\end{columns}
\end{frame}
%%%


%%%
\begin{frame}{Treshold and Nonce}
	\begin{columns}
	\column{0.7\textwidth}
		\begin{itemize}
			\item \textbf{Treshold:} Shows the maximum hash value a block header may have in order to be considered valid by the network and become part of the blockchain
			\item \textbf{Nonce:} Primary source of variation in block creation. Ensures that blocks with otherwise equivalent content can nevertheless have different hash values.
		\end{itemize}
	\column{0.3\textwidth}
		\begin{figure}
			\input{../assets/figures/block_content_3}
		\end{figure}
	\end{columns}
\end{frame}
%%%


%%%
\begin{frame}{Block Structure}
	\begin{columns}
	\column{0.5\textwidth}
		\begin{itemize}
			\item \textbf{Magic no:} Value always 0xD9B4BEF9
			\item \textbf{Block Size:} Number of bytes following up to end of block
			\item \textbf{TRX Counter:} xxx
		\end{itemize}
	\column{0.5\textwidth}
		\begin{figure}
		
\begin{tikzpicture}[domain=-8:8,scale=1.2, every node/.style={scale=1.2}]
  
  % Block 
  \draw[fill=white] (-2,0.2) -- (1,0.2) -- (1,6) -- (-2,6) node[above,midway] {{}} -- (-2,0.2);
  
  % Magic No
  \draw[dashed, fill=highlight!15] (-1.8,5.3) -- (0.8,5.3) node[above, midway] {\alert{\small{Magic Number}}}-- (0.8,5.9) -- (-1.8,5.9) -- (-1.8,5.3); 
  
  % Blocksize
  \draw[dashed, fill=highlight!15] (-1.8,4.6) -- (0.8,4.6)  node[above, midway] {\alert{\small{Block Size}}} -- (0.8,5.2) -- (-1.8,5.2) --(-1.8,4.6); 
  
  % Header
    \draw[dashed, fill=highlight!15] (-1.8,1.8) -- (0.8,1.8) -- (0.8,4.5) -- (-1.8,4.5) -- (-1.8,1.8);    
    %\draw[color=black, ->, dashed] (0.8,2.45) -- (2.35,2.8);
    \draw[color=black] plot (-0.5,4)    node[above] {\small{Block Header}};
    %\draw[densely dotted] (-1.7,1.9) -- (0.7,1.9) -- (0.7,2.3) -- (-1.7,2.3) -- (-1.7,1.9);
    
  % Transaction Counter
     \draw[dashed, fill=highlight!15] (-1.8,1.1) -- (0.8,1.1) node[above, midway] {\alert{\small{TRX Counter}}} -- (0.8,1.7) -- (-1.8,1.7) -- (-1.8,1.1) ;
     %\draw[color=black] plot (-0.5,1.4)    node[above] {\small{TRX Counter}}; 
    
  % Transactions
    \draw[dashed, fill=highlight!15] (-1.8,1) -- (0.8,1) -- (0.8,0.4) -- (-1.8,0.4) node[above,midway] {\small{Transactions}} -- (-1.8,0.8);
    %\draw[color=black, ->, densely dashed,thick] (-0.5,0.7) -- (-0.5,1.3);
    
    \node[right] at (-1.75,3.85) {\tiny{$\bullet$ Version}} ;
    \node[right] at (-1.75,3.5) {\tiny{$\bullet$ Reference}} ;
    \node[right] at (-1.75,3.15) {\tiny{$\bullet$ Timestamp}} ;
    \node[right] at (-1.75,2.8) {\tiny{$\bullet$ Treshold}} ;
    \node[right] at (-1.75,2.45) {\tiny{$\bullet$ Nonce}} ;
    \node[right] at (-1.75,2.1) {\tiny{$\bullet$ Merkle Root}} ;
  
\end{tikzpicture}

		\end{figure}
	\end{columns}
\end{frame}
%%%


%%%
\begin{frame}{Block Height and -Depth}
	\begin{figure}
		\input{../assets/figures/block_id}
	\end{figure}
\textbf{Block Identification:}
	\begin{itemize}
 		\item Block Height (static, not unique in case of fork)
 		\item Block Depth (dynamic)
 		\item Block Header hash value / Block ID (static)
	\end{itemize}
\end{frame}
%%%


%%%
\begin{frame}{The Domino Effect 1}
	\begin{figure}
		\input{../assets/figures/chain_structure_1}
	\end{figure}
\end{frame}
%%%


%%%
\begin{frame}{The Domino Effect 2}
	\begin{figure}
		\input{../assets/figures/chain_structure_2}
	\end{figure}
	\begin{itemize}
		\item Modification of transactions in Block 0 will change its merkle root and therefore the block header hash, which invalidates the reference to Block 1.
	\end{itemize}
\end{frame}
%%%


%%%
\begin{frame}{The Domino Effect 3}
	\begin{figure}
		\input{../assets/figures/chain_structure_3}
	\end{figure}
	\begin{itemize}
		\item Modification of the reference in Block 1 will change its block header hash and invalidate the reference to Block 2.
	\end{itemize}
\end{frame}
%%%


%%%
\begin{frame}{Extending the Chain}
	\begin{figure}[h!]
	\center
		\input{../assets/figures/chain_extension}
	\end{figure}
\vspace{1em}
%Each of these nodes believes that its own block candidate should be added to the blockchain and will ignore those of other network participants. This is why we need consensus...
\end{frame}

%%%

\end{document}